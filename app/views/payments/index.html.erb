<h1>Pagos</h1>

<%= form_tag("/payments", method: "get") do %>
  <div class="field">
    <%= text_field_tag(:start_date, @start_date.strftime('%m/%d/%Y'), "data-provide" => 'datepicker') %>
    <%= text_field_tag(:end_date, @end_date.strftime('%m/%d/%Y'), "data-provide" => 'datepicker') %>
    <%= submit_tag 'Buscar', class: "btn btn-primary"%>
  </div>
<% end %>

<br>

<h4> <%= "Se han registrado #{@montly_payments_count} pagos
          en el rango de fechas introducidas " %> </h4>

<%= line_chart @montly_payments %>

<br>

<h4> Historia de pagos </h4>

<table class="table">
  <thead class="thead-light">
    <tr>
      <th>Fecha</th>
      <th>Cantidad</th>
      <th>Status</th>
      <th>Atleta</th>
    </tr>
  </thead>

  <% @all_payments.each do |payment| %>
    <tr>
      <td><%= payment.date.strftime('%m/%d/%Y') %></td>
      <td><%= payment.amount %></td>
      <td><%= payment.status %></td>
      <td><%= payment.user.username %></td>
    </tr>
  <% end %>
</table>

<!-- Graficas que le sirven al administrador-->
<% if @is_admin == true %>

  <br>
  <h3> Pagos por mes desde <%= Time.now.beginning_of_year.strftime('%m/%d/%Y')%> </h3>
  <%= line_chart @monthly_payments_all %>
  <br>

  <br>
  <h3> Pagos por semana desde <%= Time.now.beginning_of_year.strftime('%m/%d/%Y')%> </h3>
  <%= line_chart @weekly_payments_all %>
  <br>
  
<% end %>

<br>
